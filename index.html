<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tech Jobs Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Paleta modo oscuro */
    :root {
      --background: hsl(224, 71%, 4%);
      --foreground: hsl(210, 40%, 98%);
      --primary: hsl(210, 40%, 98%);
      --accent: hsl(197, 71%, 73%);
      --card: hsl(224, 71%, 9%);
      --secondary: hsl(224, 71%, 14%);
      --muted-foreground: hsl(210, 40%, 80%);
    }

    body {
      background-color: var(--background);
      color: var(--foreground);
      font-family: system-ui, sans-serif;
    }

    a:hover {
      color: var(--accent);
    }
  </style>
</head>
<body class="min-h-screen p-6">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-primary">Últimas Ofertas de Trabajo</h1>
    <div id="jobs-list" class="space-y-4"></div>
  </div>

  <script>
    // Determinar JSON a cargar según query string
    const params = new URLSearchParams(window.location.search);
    const type = params.get('type') || 'it'; // it o marketing
    const jsonFile = type === 'marketing' ? 'jobsMarketing.json' : 'jobsIt.json';

    async function loadJobs() {
      const res = await fetch(jsonFile);
      let jobs = await res.json();

      // Si tu JSON viene dentro de "text" con markdown, parsea igual que en n8n
      jobs = jobs.flatMap(item => {
        let txt = item.text || '';
        txt = txt.replace(/```json/g, '').replace(/```/g, '').trim();
        try {
          const parsed = JSON.parse(txt);
          return Array.isArray(parsed) ? parsed : [];
        } catch(e) {
          return [];
        }
      });

      // Eliminar duplicados por title + company
      const uniqueJobs = [...new Map(jobs.map(job => [job.title + job.company, job])).values()];

      const container = document.getElementById('jobs-list');
      container.innerHTML = '';

      uniqueJobs.forEach(job => {
        const div = document.createElement('div');
        div.className = "bg-card p-4 rounded shadow hover:shadow-lg transition transform hover:-translate-y-1";
        div.innerHTML = `
          <a href="${job.url || '#'}" target="_blank" class="text-accent font-semibold text-lg hover:underline">
            ${job.title}
          </a>
          <p class="text-secondary mt-1">${job.company}</p>
          <p class="text-muted-foreground mt-1 text-sm">Match: ${job.matchPercentage || '-'}%</p>
          <p class="mt-2 text-foreground">${job.roleSummary || ''}</p>
          <div class="mt-2 flex flex-wrap gap-2">
            ${(job.technologies || []).map(tech => `<span class="px-2 py-1 bg-secondary text-accent rounded-full text-xs">${tech}</span>`).join('')}
          </div>
        `;
        container.appendChild(div);
      });
    }

    loadJobs();
  </script>
</body>
</html>
